{% extends "base.html" %}

{% block title %}{{ 'Edit' if method else 'New' }} Treatment Method - Jal Sarovar{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Breadcrumbs -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('dashboard.index') }}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('interventions.index') }}">Interventions</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('interventions.list_methods') }}">Methods</a></li>
                    <li class="breadcrumb-item active">{{ 'Edit' if method else 'New' }} Method</li>
                </ol>
            </nav>

            <!-- Page Header -->
            <div class="card shadow-sm mb-4">
                <div class="card-body bg-light">
                    <h2 class="mb-0">
                        <i class="bi bi-{{ 'pencil' if method else 'plus-circle' }}"></i>
                        {{ 'Edit' if method else 'New' }} Treatment Method
                    </h2>
                </div>
            </div>

            <!-- Method Form -->
            <form method="POST" action="{{ url_for('interventions.edit_method', method_id=method.id) if method else url_for('interventions.new_method') }}">
                <!-- Basic Information -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-info-circle"></i> Basic Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="method_name" class="form-label">
                                    <strong>Method Name</strong> <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="method_name" name="method_name" required
                                       value="{{ method.method_name if method else '' }}"
                                       placeholder="e.g., Chlorination, UV Disinfection">
                            </div>
                            <div class="col-md-4">
                                <label for="method_code" class="form-label">Method Code</label>
                                <input type="text" class="form-control" id="method_code" name="method_code"
                                       value="{{ method.method_code if method else '' }}"
                                       placeholder="e.g., CHLOR-01">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"
                                      placeholder="Describe the treatment method, how it works, and when to use it...">{{ method.description if method else '' }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="is_active" name="is_active"
                                           {% if not method or method.is_active %}checked{% endif %}>
                                    <label class="form-check-label" for="is_active">
                                        <i class="bi bi-check-circle text-success"></i> Active
                                        <br><small class="text-muted">Available for selection in interventions</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Information -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-currency-rupee"></i> Cost Information</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="estimated_cost_min_inr" class="form-label">Min Estimated Cost (INR)</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs</span>
                                    <input type="number" step="0.01" class="form-control" id="estimated_cost_min_inr" name="estimated_cost_min_inr"
                                           value="{{ method.estimated_cost_min_inr if method and method.estimated_cost_min_inr else '' }}"
                                           placeholder="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="estimated_cost_max_inr" class="form-label">Max Estimated Cost (INR)</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs</span>
                                    <input type="number" step="0.01" class="form-control" id="estimated_cost_max_inr" name="estimated_cost_max_inr"
                                           value="{{ method.estimated_cost_max_inr if method and method.estimated_cost_max_inr else '' }}"
                                           placeholder="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="cost_per_kl" class="form-label">Cost per Kiloliter (INR)</label>
                                <div class="input-group">
                                    <span class="input-group-text">Rs</span>
                                    <input type="number" step="0.01" class="form-control" id="cost_per_kl" name="cost_per_kl"
                                           value="{{ method.cost_per_kl if method and method.cost_per_kl else '' }}"
                                           placeholder="0">
                                    <span class="input-group-text">/KL</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Effectiveness & Duration -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-graph-up"></i> Effectiveness & Duration</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="average_effectiveness_percent" class="form-label">Average Effectiveness (%)</label>
                                <div class="input-group">
                                    <input type="number" step="0.1" min="0" max="100" class="form-control" id="average_effectiveness_percent" name="average_effectiveness_percent"
                                           value="{{ method.average_effectiveness_percent if method and method.average_effectiveness_percent else '' }}"
                                           placeholder="e.g., 85">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="time_to_effect_days" class="form-label">Time to Effect (Days)</label>
                                <input type="number" min="0" class="form-control" id="time_to_effect_days" name="time_to_effect_days"
                                       value="{{ method.time_to_effect_days if method and method.time_to_effect_days else '' }}"
                                       placeholder="e.g., 1">
                            </div>
                            <div class="col-md-4">
                                <label for="duration_effectiveness_months" class="form-label">Effectiveness Duration (Months)</label>
                                <input type="number" min="0" class="form-control" id="duration_effectiveness_months" name="duration_effectiveness_months"
                                       value="{{ method.duration_effectiveness_months if method and method.duration_effectiveness_months else '' }}"
                                       placeholder="e.g., 3">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <label for="implementation_time_days" class="form-label">Implementation Time (Days)</label>
                                <input type="number" min="0" class="form-control" id="implementation_time_days" name="implementation_time_days"
                                       value="{{ method.implementation_time_days if method and method.implementation_time_days else '' }}"
                                       placeholder="e.g., 2">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Requirements -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-tools"></i> Requirements</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="requires_specialist" name="requires_specialist"
                                           {% if method and method.requires_specialist %}checked{% endif %}>
                                    <label class="form-check-label" for="requires_specialist">
                                        <i class="bi bi-person-badge text-info"></i> Requires Specialist
                                        <br><small class="text-muted">Trained personnel needed for implementation</small>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="requires_equipment" name="requires_equipment"
                                           {% if method and method.requires_equipment %}checked{% endif %}>
                                    <label class="form-check-label" for="requires_equipment">
                                        <i class="bi bi-tools text-secondary"></i> Requires Equipment
                                        <br><small class="text-muted">Special equipment or machinery needed</small>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="equipment_list" class="form-label">Equipment List</label>
                            <textarea class="form-control" id="equipment_list" name="equipment_list" rows="2"
                                      placeholder="List required equipment, one per line or comma-separated...">{{ method.equipment_list if method else '' }}</textarea>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body d-flex justify-content-between">
                        <a href="{{ url_for('interventions.list_methods') }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> {{ 'Save Changes' if method else 'Create Method' }}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
