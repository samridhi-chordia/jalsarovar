{% extends "base.html" %}

{% block title %}Edit Sample {{ sample.sample_id }} - Jal Sarovar{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-pencil"></i> Edit Sample {{ sample.sample_id }}</h1>
    <div>
        <a href="{{ url_for('samples.view', sample_id=sample.id) }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Sample
        </a>
    </div>
</div>

<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('samples.edit', sample_id=sample.id) }}">
                    <!-- Basic Information (Read-only) -->
                    <h5 class="mb-3"><i class="bi bi-info-circle"></i> Basic Information</h5>
                    <div class="alert alert-info">
                        <strong>Sample ID:</strong> {{ sample.sample_id }}<br>
                        <strong>Site:</strong> {{ sample.site.site_name if sample.site else 'N/A' }}<br>
                        <strong>Collection Date:</strong> {{ sample.collection_date.strftime('%Y-%m-%d') }}<br>
                        <strong>Collection Time:</strong> {{ sample.collection_time.strftime('%H:%M') if sample.collection_time else 'N/A' }}<br>
                        <em>Note: Basic collection information cannot be edited</em>
                    </div>

                    <!-- Location Details -->
                    <h5 class="mb-3 mt-4"><i class="bi bi-geo-alt"></i> Location Details</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-12">
                            <label for="sub_site_details" class="form-label">Sub-site Details</label>
                            <input type="text" class="form-control" id="sub_site_details" name="sub_site_details"
                                   value="{{ sample.sub_site_details or '' }}"
                                   placeholder="e.g., Building A, Floor 2, Tap 3">
                        </div>
                        <div class="col-md-6">
                            <label for="exact_latitude" class="form-label">Latitude</label>
                            <input type="number" step="any" class="form-control" id="exact_latitude" name="exact_latitude"
                                   value="{{ sample.exact_latitude or '' }}"
                                   placeholder="e.g., 12.9716">
                        </div>
                        <div class="col-md-6">
                            <label for="exact_longitude" class="form-label">Longitude</label>
                            <input type="number" step="any" class="form-control" id="exact_longitude" name="exact_longitude"
                                   value="{{ sample.exact_longitude or '' }}"
                                   placeholder="e.g., 77.5946">
                        </div>
                    </div>

                    <!-- Source Details -->
                    <h5 class="mb-3"><i class="bi bi-droplet"></i> Source Details</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label for="source_type" class="form-label">Source Type</label>
                            <select class="form-select" id="source_type" name="source_type">
                                <option value="">Select type...</option>
                                <option value="tap" {% if sample.source_type == 'tap' %}selected{% endif %}>Tap</option>
                                <option value="well" {% if sample.source_type == 'well' %}selected{% endif %}>Well</option>
                                <option value="borehole" {% if sample.source_type == 'borehole' %}selected{% endif %}>Borehole</option>
                                <option value="river" {% if sample.source_type == 'river' %}selected{% endif %}>River</option>
                                <option value="lake" {% if sample.source_type == 'lake' %}selected{% endif %}>Lake</option>
                                <option value="treatment_plant" {% if sample.source_type == 'treatment_plant' %}selected{% endif %}>Treatment Plant</option>
                                <option value="storage_tank" {% if sample.source_type == 'storage_tank' %}selected{% endif %}>Storage Tank</option>
                                <option value="other" {% if sample.source_type == 'other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="source_depth_meters" class="form-label">Source Depth (meters)</label>
                            <input type="number" step="0.1" class="form-control" id="source_depth_meters" name="source_depth_meters"
                                   value="{{ sample.source_depth_meters or '' }}">
                        </div>
                        <div class="col-md-4">
                            <label for="water_source_root" class="form-label">Water Source Root</label>
                            <select class="form-select" id="water_source_root" name="water_source_root">
                                <option value="">Select source...</option>
                                <option value="municipal" {% if sample.water_source_root == 'municipal' %}selected{% endif %}>Municipal</option>
                                <option value="groundwater" {% if sample.water_source_root == 'groundwater' %}selected{% endif %}>Groundwater</option>
                                <option value="surface_water" {% if sample.water_source_root == 'surface_water' %}selected{% endif %}>Surface Water</option>
                                <option value="rainwater" {% if sample.water_source_root == 'rainwater' %}selected{% endif %}>Rainwater</option>
                                <option value="mixed" {% if sample.water_source_root == 'mixed' %}selected{% endif %}>Mixed</option>
                                <option value="unknown" {% if sample.water_source_root == 'unknown' %}selected{% endif %}>Unknown</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="storage_type" class="form-label">Storage Type</label>
                            <select class="form-select" id="storage_type" name="storage_type">
                                <option value="">Select type...</option>
                                <option value="overhead_tank" {% if sample.storage_type == 'overhead_tank' %}selected{% endif %}>Overhead Tank</option>
                                <option value="underground_tank" {% if sample.storage_type == 'underground_tank' %}selected{% endif %}>Underground Tank</option>
                                <option value="ground_level_tank" {% if sample.storage_type == 'ground_level_tank' %}selected{% endif %}>Ground Level Tank</option>
                                <option value="no_storage" {% if sample.storage_type == 'no_storage' %}selected{% endif %}>No Storage</option>
                                <option value="other" {% if sample.storage_type == 'other' %}selected{% endif %}>Other</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="storage_material" class="form-label">Storage Material</label>
                            <input type="text" class="form-control" id="storage_material" name="storage_material"
                                   value="{{ sample.storage_material or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="discharge_type" class="form-label">Discharge Type</label>
                            <input type="text" class="form-control" id="discharge_type" name="discharge_type"
                                   value="{{ sample.discharge_type or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="discharge_material" class="form-label">Discharge Material</label>
                            <input type="text" class="form-control" id="discharge_material" name="discharge_material"
                                   value="{{ sample.discharge_material or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="is_recycled" class="form-label">Is Recycled?</label>
                            <select class="form-select" id="is_recycled" name="is_recycled">
                                <option value="">Select...</option>
                                <option value="yes" {% if sample.is_recycled %}selected{% endif %}>Yes</option>
                                <option value="no" {% if not sample.is_recycled %}selected{% endif %}>No</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="source_age_years" class="form-label">Source Age (years)</label>
                            <input type="number" step="1" class="form-control" id="source_age_years" name="source_age_years"
                                   value="{{ sample.source_age_years or '' }}">
                        </div>
                    </div>

                    <!-- Infrastructure -->
                    <h5 class="mb-3"><i class="bi bi-building"></i> Infrastructure</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="pipe_material" class="form-label">Pipe Material</label>
                            <select class="form-select" id="pipe_material" name="pipe_material">
                                <option value="">Select material...</option>
                                <option value="pvc" {% if sample.pipe_material == 'pvc' %}selected{% endif %}>PVC</option>
                                <option value="hdpe" {% if sample.pipe_material == 'hdpe' %}selected{% endif %}>HDPE</option>
                                <option value="gi" {% if sample.pipe_material == 'gi' %}selected{% endif %}>GI (Galvanized Iron)</option>
                                <option value="copper" {% if sample.pipe_material == 'copper' %}selected{% endif %}>Copper</option>
                                <option value="concrete" {% if sample.pipe_material == 'concrete' %}selected{% endif %}>Concrete</option>
                                <option value="mixed" {% if sample.pipe_material == 'mixed' %}selected{% endif %}>Mixed</option>
                                <option value="unknown" {% if sample.pipe_material == 'unknown' %}selected{% endif %}>Unknown</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="pipe_age_years" class="form-label">Pipe Age (years)</label>
                            <input type="number" step="1" class="form-control" id="pipe_age_years" name="pipe_age_years"
                                   value="{{ sample.pipe_age_years or '' }}">
                        </div>
                        <div class="col-md-12">
                            <label for="distance_from_source_meters" class="form-label">Distance from Source (meters)</label>
                            <input type="number" step="0.1" class="form-control" id="distance_from_source_meters" name="distance_from_source_meters"
                                   value="{{ sample.distance_from_source_meters or '' }}">
                        </div>
                    </div>

                    <!-- Environmental Conditions -->
                    <h5 class="mb-3"><i class="bi bi-cloud-sun"></i> Environmental Conditions</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label for="weather_condition" class="form-label">Weather Condition</label>
                            <select class="form-select" id="weather_condition" name="weather_condition">
                                <option value="">Select condition...</option>
                                <option value="sunny" {% if sample.weather_condition == 'sunny' %}selected{% endif %}>Sunny</option>
                                <option value="cloudy" {% if sample.weather_condition == 'cloudy' %}selected{% endif %}>Cloudy</option>
                                <option value="rainy" {% if sample.weather_condition == 'rainy' %}selected{% endif %}>Rainy</option>
                                <option value="stormy" {% if sample.weather_condition == 'stormy' %}selected{% endif %}>Stormy</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="rained_recently" class="form-label">Rained Recently?</label>
                            <select class="form-select" id="rained_recently" name="rained_recently">
                                <option value="">Select...</option>
                                <option value="yes" {% if sample.rained_recently %}selected{% endif %}>Yes</option>
                                <option value="no" {% if not sample.rained_recently %}selected{% endif %}>No</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="days_since_rain" class="form-label">Days Since Rain</label>
                            <input type="number" step="1" class="form-control" id="days_since_rain" name="days_since_rain"
                                   value="{{ sample.days_since_rain or '' }}">
                        </div>
                        <div class="col-md-12">
                            <label for="ambient_temperature_celsius" class="form-label">Ambient Temperature (Â°C)</label>
                            <input type="number" step="0.1" class="form-control" id="ambient_temperature_celsius" name="ambient_temperature_celsius"
                                   value="{{ sample.ambient_temperature_celsius or '' }}">
                        </div>
                    </div>

                    <!-- Observations -->
                    <h5 class="mb-3"><i class="bi bi-eye"></i> Observations</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label for="water_appearance" class="form-label">Water Appearance</label>
                            <select class="form-select" id="water_appearance" name="water_appearance">
                                <option value="">Select appearance...</option>
                                <option value="clear" {% if sample.water_appearance == 'clear' %}selected{% endif %}>Clear</option>
                                <option value="cloudy" {% if sample.water_appearance == 'cloudy' %}selected{% endif %}>Cloudy</option>
                                <option value="turbid" {% if sample.water_appearance == 'turbid' %}selected{% endif %}>Turbid</option>
                                <option value="colored" {% if sample.water_appearance == 'colored' %}selected{% endif %}>Colored</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="odor_present" class="form-label">Odor Present?</label>
                            <select class="form-select" id="odor_present" name="odor_present">
                                <option value="">Select...</option>
                                <option value="yes" {% if sample.odor_present %}selected{% endif %}>Yes</option>
                                <option value="no" {% if not sample.odor_present %}selected{% endif %}>No</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="visible_particles" class="form-label">Visible Particles?</label>
                            <select class="form-select" id="visible_particles" name="visible_particles">
                                <option value="">Select...</option>
                                <option value="yes" {% if sample.visible_particles %}selected{% endif %}>Yes</option>
                                <option value="no" {% if not sample.visible_particles %}selected{% endif %}>No</option>
                            </select>
                        </div>
                        <div class="col-md-12">
                            <label for="odor_description" class="form-label">Odor Description</label>
                            <input type="text" class="form-control" id="odor_description" name="odor_description"
                                   value="{{ sample.odor_description or '' }}"
                                   placeholder="Describe the odor if present...">
                        </div>
                    </div>

                    <!-- Status & Priority -->
                    <h5 class="mb-3"><i class="bi bi-flag"></i> Status & Priority</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select" id="status" name="status">
                                <option value="collected" {% if sample.status == 'collected' %}selected{% endif %}>Collected</option>
                                <option value="tested" {% if sample.status == 'tested' %}selected{% endif %}>Tested</option>
                                <option value="analyzed" {% if sample.status == 'analyzed' %}selected{% endif %}>Analyzed</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="priority" class="form-label">Priority</label>
                            <select class="form-select" id="priority" name="priority">
                                <option value="">Select priority...</option>
                                <option value="low" {% if sample.priority == 'low' %}selected{% endif %}>Low</option>
                                <option value="medium" {% if sample.priority == 'medium' %}selected{% endif %}>Medium</option>
                                <option value="high" {% if sample.priority == 'high' %}selected{% endif %}>High</option>
                                <option value="urgent" {% if sample.priority == 'urgent' %}selected{% endif %}>Urgent</option>
                            </select>
                        </div>
                    </div>

                    <!-- Notes -->
                    <h5 class="mb-3"><i class="bi bi-sticky"></i> Additional Notes</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <label for="collection_notes" class="form-label">Collection Notes</label>
                            <textarea class="form-control" id="collection_notes" name="collection_notes" rows="3"
                                      placeholder="Any notes about the collection process...">{{ sample.collection_notes or '' }}</textarea>
                        </div>
                        <div class="col-12">
                            <label for="special_observations" class="form-label">Special Observations</label>
                            <textarea class="form-control" id="special_observations" name="special_observations" rows="3"
                                      placeholder="Any unusual observations or concerns...">{{ sample.special_observations or '' }}</textarea>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="d-flex gap-2 justify-content-end">
                        <a href="{{ url_for('samples.view', sample_id=sample.id) }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
