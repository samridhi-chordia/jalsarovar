{% extends "base.html" %}
{% block title %}Add Test Results - Jal Sarovar{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="bi bi-clipboard-plus"></i> Add Test Results</h2>
        <p class="text-muted mb-0">Sample: {{ sample.sample_id }} | Site: {{ sample.site.site_name }}</p>
    </div>
    <a href="{{ url_for('samples.detail', sample_id=sample.id) }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Sample
    </a>
</div>

<form method="POST" action="{{ url_for('samples.add_test_results', sample_id=sample.id) }}">
    <!-- Physical Parameters -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-thermometer"></i> Physical Parameters</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">pH <span class="text-muted">(6.5-8.5)</span></label>
                    <input type="number" step="0.01" name="ph" class="form-control" placeholder="e.g., 7.2">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Temperature (°C)</label>
                    <input type="number" step="0.1" name="temperature_celsius" class="form-control" placeholder="e.g., 25">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Turbidity (NTU) <span class="text-muted">(&lt;5)</span></label>
                    <input type="number" step="0.1" name="turbidity_ntu" class="form-control" placeholder="e.g., 2.5">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Color (Hazen)</label>
                    <input type="number" step="1" name="color_hazen" class="form-control" placeholder="e.g., 10">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Conductivity (µS/cm)</label>
                    <input type="number" step="1" name="conductivity_us_cm" class="form-control" placeholder="e.g., 500">
                </div>
            </div>
        </div>
    </div>

    <!-- Chemical Parameters -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-droplet-half"></i> Chemical Parameters</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">TDS (ppm) <span class="text-muted">(&lt;500)</span></label>
                    <input type="number" step="1" name="tds_ppm" class="form-control" placeholder="e.g., 350">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Total Hardness (mg/L)</label>
                    <input type="number" step="1" name="total_hardness_mg_l" class="form-control" placeholder="e.g., 200">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Free Chlorine (mg/L) <span class="text-muted">(0.2-5.0)</span></label>
                    <input type="number" step="0.01" name="free_chlorine_mg_l" class="form-control" placeholder="e.g., 0.5">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Chloride (mg/L)</label>
                    <input type="number" step="1" name="chloride_mg_l" class="form-control" placeholder="e.g., 150">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Fluoride (mg/L) <span class="text-muted">(&lt;1.5)</span></label>
                    <input type="number" step="0.01" name="fluoride_mg_l" class="form-control" placeholder="e.g., 0.8">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Nitrate (mg/L) <span class="text-muted">(&lt;45)</span></label>
                    <input type="number" step="0.1" name="nitrate_mg_l" class="form-control" placeholder="e.g., 20">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Sulfate (mg/L)</label>
                    <input type="number" step="1" name="sulfate_mg_l" class="form-control" placeholder="e.g., 100">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Ammonia (mg/L)</label>
                    <input type="number" step="0.01" name="ammonia_mg_l" class="form-control" placeholder="e.g., 0.1">
                </div>
            </div>
        </div>
    </div>

    <!-- Heavy Metals -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Heavy Metals</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Iron (mg/L) <span class="text-muted">(&lt;0.3)</span></label>
                    <input type="number" step="0.001" name="iron_mg_l" class="form-control" placeholder="e.g., 0.1">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Manganese (mg/L) <span class="text-muted">(&lt;0.4)</span></label>
                    <input type="number" step="0.001" name="manganese_mg_l" class="form-control" placeholder="e.g., 0.05">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Arsenic (mg/L) <span class="text-muted">(&lt;0.01)</span></label>
                    <input type="number" step="0.001" name="arsenic_mg_l" class="form-control" placeholder="e.g., 0.005">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Lead (mg/L) <span class="text-muted">(&lt;0.01)</span></label>
                    <input type="number" step="0.001" name="lead_mg_l" class="form-control" placeholder="e.g., 0.002">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Copper (mg/L)</label>
                    <input type="number" step="0.001" name="copper_mg_l" class="form-control" placeholder="e.g., 0.05">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Zinc (mg/L)</label>
                    <input type="number" step="0.01" name="zinc_mg_l" class="form-control" placeholder="e.g., 0.1">
                </div>
            </div>
        </div>
    </div>

    <!-- Microbiological -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-bug"></i> Microbiological</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Total Coliform (MPN) <span class="text-muted">(0)</span></label>
                    <input type="number" step="1" name="total_coliform_mpn" class="form-control" placeholder="e.g., 0">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Fecal Coliform (MPN)</label>
                    <input type="number" step="1" name="fecal_coliform_mpn" class="form-control" placeholder="e.g., 0">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">E. coli (MPN) <span class="text-muted">(0)</span></label>
                    <input type="number" step="1" name="e_coli_mpn" class="form-control" placeholder="e.g., 0">
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Total Plate Count</label>
                    <input type="number" step="1" name="total_plate_count" class="form-control" placeholder="e.g., 100">
                </div>
            </div>
        </div>
    </div>

    <!-- Lab Info -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-building"></i> Lab Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Lab Name</label>
                    <input type="text" name="lab_name" class="form-control" placeholder="Enter lab name">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Test Date</label>
                    <input type="date" name="test_date" class="form-control" value="{{ now().strftime('%Y-%m-%d') if now else '' }}">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Tested By</label>
                    <input type="text" name="tested_by" class="form-control" placeholder="Technician name">
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-end gap-2">
        <a href="{{ url_for('samples.detail', sample_id=sample.id) }}" class="btn btn-outline-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-save"></i> Save Test Results
        </button>
    </div>
</form>
{% endblock %}
