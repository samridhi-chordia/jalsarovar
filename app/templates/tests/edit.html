{% extends "base.html" %}

{% block title %}Edit Test Result - Jal Sarovar{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-pencil"></i> Edit Test Result</h1>
    <div>
        <a href="{{ url_for('tests.view', test_id=test_result.id) }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Test
        </a>
    </div>
</div>

<div class="alert alert-info mb-4">
    <strong>Sample:</strong> {{ test_result.sample.sample_id }} |
    <strong>Test Date:</strong> {{ test_result.test_date.strftime('%Y-%m-%d') if test_result.test_date else 'N/A' }} |
    <strong>Tested By:</strong> {{ test_result.tested_by or 'N/A' }}
</div>

<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('tests.edit', test_id=test_result.id) }}">
                    <p class="text-muted mb-4">
                        <i class="bi bi-info-circle"></i>
                        Only key parameters can be edited. Contact an administrator to modify test metadata or dates.
                    </p>

                    <!-- Key Parameters -->
                    <h5 class="mb-3"><i class="bi bi-droplet"></i> Key Parameters</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label for="turbidity_ntu" class="form-label">Turbidity (NTU)</label>
                            <input type="number" step="0.01" class="form-control" id="turbidity_ntu" name="turbidity_ntu"
                                   value="{{ test_result.turbidity_ntu or '' }}">
                        </div>
                        <div class="col-md-4">
                            <label for="temperature_celsius" class="form-label">Temperature (Â°C)</label>
                            <input type="number" step="0.1" class="form-control" id="temperature_celsius" name="temperature_celsius"
                                   value="{{ test_result.temperature_celsius or '' }}">
                        </div>
                        <div class="col-md-4">
                            <label for="ph_value" class="form-label">pH Value</label>
                            <input type="number" step="0.01" class="form-control" id="ph_value" name="ph_value"
                                   value="{{ test_result.ph_value or '' }}">
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label for="tds_ppm" class="form-label">TDS (ppm)</label>
                            <input type="number" step="1" class="form-control" id="tds_ppm" name="tds_ppm"
                                   value="{{ test_result.tds_ppm or '' }}">
                        </div>
                        <div class="col-md-4">
                            <label for="salinity_ppm" class="form-label">Salinity (ppm)</label>
                            <input type="number" step="1" class="form-control" id="salinity_ppm" name="salinity_ppm"
                                   value="{{ test_result.salinity_ppm or '' }}">
                        </div>
                        <div class="col-md-4">
                            <label for="free_chlorine_mg_l" class="form-label">Free Chlorine (mg/L)</label>
                            <input type="number" step="0.01" class="form-control" id="free_chlorine_mg_l" name="free_chlorine_mg_l"
                                   value="{{ test_result.free_chlorine_mg_l or '' }}">
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label for="iron_mg_l" class="form-label">Iron (mg/L)</label>
                            <input type="number" step="0.01" class="form-control" id="iron_mg_l" name="iron_mg_l"
                                   value="{{ test_result.iron_mg_l or '' }}">
                        </div>
                        <div class="col-md-6">
                            <label for="coliform_status" class="form-label">Coliform Status</label>
                            <select class="form-select" id="coliform_status" name="coliform_status">
                                <option value="">Select status...</option>
                                <option value="absent" {% if test_result.coliform_status == 'absent' %}selected{% endif %}>Absent</option>
                                <option value="present" {% if test_result.coliform_status == 'present' %}selected{% endif %}>Present</option>
                            </select>
                        </div>
                    </div>

                    <!-- Notes -->
                    <h5 class="mb-3"><i class="bi bi-sticky"></i> Test Notes</h5>
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <label for="test_notes" class="form-label">Notes</label>
                            <textarea class="form-control" id="test_notes" name="test_notes" rows="3">{{ test_result.test_notes or '' }}</textarea>
                        </div>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="d-flex gap-2 justify-content-end">
                        <a href="{{ url_for('tests.view', test_id=test_result.id) }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
